@using System.Security.Claims
@using StudentSystem.Client.Services.AuthServices

@inject IClientAuthService clientAuthService

<div class="top-row ps-3 navbar navbar-dark">
    <div class="container-fluid">
        <a class="navbar-brand" href="">StudentSystem.Client</a>
        <button title="Navigation menu" class="navbar-toggler" @onclick="ToggleNavMenu">
            <span class="navbar-toggler-icon"></span>
        </button>
    </div>
</div>

<div class="@NavMenuCssClass nav-scrollable" @onclick="ToggleNavMenu" style="overflow-x: hidden;">
    <nav class="flex-column">

        <AuthorizeView>
            <Authorized>
                <div class="d-flex justify-content-center mt-5">
                    <MudImage Src="@avatar" Style="width: 120px; height:120px;"></MudImage>
                </div>
                <div class="d-flex justify-content-center mt-2 mb-5">
                    <span style="color:white; font-size:17px; margin-top: 6px; font-weight: 500; text-align: center">  @context.User.Identity.Name</span>
                </div>
            </Authorized>
        </AuthorizeView>

        <MudPaper Width="250px" Class="py-3" Elevation="0">
            <MudNavMenu>
             
                <MudNavLink Href="/dashboard" 
                    Icon="@Icons.Material.Filled.Dashboard" 
                    IconColor="Color.Info">Dashboard
                </MudNavLink>

                 <AuthorizeView Roles="Admin">
                     <Authorized>
                        <MudNavLink Href="/all-subjects"
                                    Icon="@Icons.Material.Filled.Subject"
                                    IconColor="Color.Info">
                            Subjects
                        </MudNavLink>
                    </Authorized>
                </AuthorizeView>
       

                <AuthorizeView Roles="Admin">
                    <Authorized>
                        <MudNavLink Href="/all-books"
                                    Icon="@Icons.Material.Filled.Book"
                                    IconColor="Color.Info">
                            Books
                        </MudNavLink>
                    </Authorized>
                </AuthorizeView>
             

                <AuthorizeView Roles="Admin">
                    <Authorized>
                        <MudNavLink Href="/all-professors"
                                    Icon="@Icons.Material.Filled.Person4"
                                    IconColor="Color.Info">
                            Professors
                        </MudNavLink>
                    </Authorized>
                </AuthorizeView>

                <AuthorizeView Roles="Admin"> 
                    <Authorized>
                        <MudNavLink Href="/all-students" 
                    Icon="@Icons.Material.Filled.Person" 
                    IconColor="Color.Info">Students
                </MudNavLink>
                    </Authorized>
                </AuthorizeView>
                

                <AuthorizeView Roles="Admin">
                    <Authorized>
                        <MudNavLink Href="/all-users"
                                    Icon="@Icons.Material.Filled.People"
                                    IconColor="Color.Info">
                            Users
                        </MudNavLink>
                    </Authorized>
                </AuthorizeView>
               
                <AuthorizeView Roles="Admin">
                    <Authorized>
                        <MudNavGroup Title="Enrollment"
                                     Expanded="@isSelected"
                                     Icon="@Icons.Material.Outlined.FolderOpen" @onclick="ToggleEnrollment"
                                     IconColor="Color.Info">
                            <MudNavLink Href="/all-enrollment">Manage Enrollment</MudNavLink>
                        </MudNavGroup>
                    </Authorized>
                </AuthorizeView>
                
     
                <AuthorizeView Roles="Admin">
                    <Authorized>
                        <MudNavGroup Title="Library"
                                     Expanded="@isSelected"
                                     Icon="@Icons.Material.Outlined.FolderOpen" @onclick="ToggleEnrollment"
                                     IconColor="Color.Info">
                            <MudNavLink Href="/all-library">Manage Library</MudNavLink>
                        </MudNavGroup>
                    </Authorized>
                </AuthorizeView>

                <AuthorizeView Roles="Student">
                    <Authorized>
                        <MudNavGroup Title="Enrollment"
                                     Expanded="@isSelected"
                                     Icon="@Icons.Material.Outlined.FolderOpen" @onclick="ToggleEnrollment"
                                     IconColor="Color.Info">
                            <MudNavLink Href="/all-students-view">Manage Enrollment</MudNavLink>
                        </MudNavGroup>
                    </Authorized>
                </AuthorizeView>

                <AuthorizeView Roles="Student">
                    <Authorized>
                        <MudNavGroup Title="Library"
                                     Expanded="@isSelected"
                                     Icon="@Icons.Material.Outlined.FolderOpen" @onclick="ToggleEnrollment"
                                     IconColor="Color.Info">
                            <MudNavLink Href="/all-library-student-view">Manage Library</MudNavLink>
                        </MudNavGroup>
                    </Authorized>
                </AuthorizeView>

                <AuthorizeView Roles="Professor">
                    <Authorized>
                        <MudNavGroup Title="Students"
                                     Expanded="@isSelected"
                                     Icon="@Icons.Material.Outlined.FolderOpen" @onclick="ToggleEnrollment"
                                     IconColor="Color.Info">
                            <MudNavLink Href="/all-students-professor-view">Manage Students</MudNavLink>
                        </MudNavGroup>
                    </Authorized>
                </AuthorizeView>
            </MudNavMenu>
        </MudPaper>

    </nav>
</div>

@code {
    private string avatar;
    private bool isSelected = false;
    private bool collapseNavMenu = true;
    private string? NavMenuCssClass => collapseNavMenu ? "collapse" : null;

    private void ToggleNavMenu()
    {
        collapseNavMenu = !collapseNavMenu;
    }

    protected override async Task OnInitializedAsync()
    {
        avatar = await clientAuthService.GetSingleUser();

    }

    void ToggleEnrollment()
    {  
        isSelected = !isSelected;
    }
}
